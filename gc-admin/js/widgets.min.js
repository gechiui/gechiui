/*! This file is auto-generated */
!function(h){var l=h(document);window.gcWidgets={hoveredSidebar:null,dirtyWidgets:{},init:function(){var r,o,c=this,d=h(".widgets-chooser"),a=d.find(".widgets-chooser-sidebars"),e=h("div.widgets-sortables"),g=!("undefined"==typeof isRtl||!isRtl);h("#widgets-right .sidebar-name").on("click",function(){var e=h(this),i=e.closest(".widgets-holder-wrap "),t=e.find(".handlediv");i.hasClass("closed")?(i.removeClass("closed"),t.attr("aria-expanded","true"),e.parent().sortable("refresh")):(i.addClass("closed"),t.attr("aria-expanded","false")),l.triggerHandler("gc-pin-menu")}).find(".handlediv").each(function(e){0!==e&&h(this).attr("aria-expanded","false")}),h(window).on("beforeunload.widgets",function(e){var i,t=[];if(h.each(c.dirtyWidgets,function(e,i){i&&t.push(e)}),0!==t.length)return(i=h("#widgets-right").find(".widget").filter(function(){return-1!==t.indexOf(h(this).prop("id").replace(/^widget-\d+_/,""))})).each(function(){h(this).hasClass("open")||h(this).find(".widget-title-action:first").trigger("click")}),i.first().each(function(){this.scrollIntoViewIfNeeded?this.scrollIntoViewIfNeeded():this.scrollIntoView(),h(this).find(".widget-inside :tabbable:first").trigger("focus")}),e.returnValue=gc.i18n.__("\u79bb\u5f00\u8fd9\u4e2a\u9875\u9762\uff0c\u60a8\u6240\u505a\u7684\u66f4\u6539\u5c06\u4e22\u5931\u3002"),e.returnValue}),h("#widgets-left .sidebar-name").on("click",function(){var e=h(this).closest(".widgets-holder-wrap");e.toggleClass("closed").find(".handlediv").attr("aria-expanded",!e.hasClass("closed")),l.triggerHandler("gc-pin-menu")}),h(document.body).on("click.widgets-toggle",function(e){var i,t,d,s,a,n,r=h(e.target),o={},l=r.closest(".widget").find(".widget-top button.widget-action");r.parents(".widget-top").length&&!r.parents("#available-widgets").length?(t=(i=r.closest("div.widget")).children(".widget-inside"),d=parseInt(i.find("input.widget-width").val(),10),s=i.parent().width(),n=t.find(".widget-id").val(),i.data("dirty-state-initialized")||((a=t.find(".widget-control-save")).prop("disabled",!0).val(gc.i18n.__("\u5df2\u4fdd\u5b58")),t.on("input change",function(){c.dirtyWidgets[n]=!0,i.addClass("widget-dirty"),a.prop("disabled",!1).val(gc.i18n.__("\u4fdd\u5b58"))}),i.data("dirty-state-initialized",!0)),t.is(":hidden")?(250<d&&s<d+30&&i.closest("div.widgets-sortables").length&&(o[i.closest("div.widget-liquid-right").length?g?"margin-right":"margin-left":g?"margin-left":"margin-right"]=s-(d+30)+"px",i.css(o)),l.attr("aria-expanded","true"),t.slideDown("fast",function(){i.addClass("open")})):(l.attr("aria-expanded","false"),t.slideUp("fast",function(){i.attr("style",""),i.removeClass("open")}))):r.hasClass("widget-control-save")?(gcWidgets.save(r.closest("div.widget"),0,1,0),e.preventDefault()):r.hasClass("widget-control-remove")?gcWidgets.save(r.closest("div.widget"),1,1,0):r.hasClass("widget-control-close")?((i=r.closest("div.widget")).removeClass("open"),l.attr("aria-expanded","false"),gcWidgets.close(i)):"inactive-widgets-control-remove"===r.attr("id")&&(gcWidgets.removeInactiveWidgets(),e.preventDefault())}),e.children(".widget").each(function(){var e=h(this);gcWidgets.appendTitle(this),e.find("p.widget-error").length&&e.find(".widget-action").trigger("click").attr("aria-expanded","true")}),h("#widget-list").children(".widget").draggable({connectToSortable:"div.widgets-sortables",handle:"> .widget-top > .widget-title",distance:2,helper:"clone",zIndex:101,containment:"#gcwrap",refreshPositions:!0,start:function(e,i){var t=h(this).find(".widgets-chooser");i.helper.find("div.widget-description").hide(),o=this.id,t.length&&(h("#gcbody-content").append(t.hide()),i.helper.find(".widgets-chooser").remove(),c.clearWidgetSelection())},stop:function(){r&&h(r).hide(),r=""}}),e.droppable({tolerance:"intersect",over:function(e){var i=h(e.target).parent();gcWidgets.hoveredSidebar&&!i.is(gcWidgets.hoveredSidebar)&&gcWidgets.closeSidebar(e),i.hasClass("closed")&&(gcWidgets.hoveredSidebar=i).removeClass("closed").find(".handlediv").attr("aria-expanded","true"),h(this).sortable("refresh")},out:function(e){gcWidgets.hoveredSidebar&&gcWidgets.closeSidebar(e)}}),e.sortable({placeholder:"widget-placeholder",items:"> .widget",handle:"> .widget-top > .widget-title",cursor:"move",distance:2,containment:"#gcwrap",tolerance:"pointer",refreshPositions:!0,start:function(e,i){var t=h(this),d=t.parent(),s=i.item.children(".widget-inside");"block"===s.css("display")&&(i.item.removeClass("open"),i.item.find(".widget-top button.widget-action").attr("aria-expanded","false"),s.hide(),h(this).sortable("refreshPositions")),d.hasClass("closed")||(s=i.item.hasClass("ui-draggable")?t.height():1+t.height(),t.css("min-height",s+"px"))},stop:function(e,i){var t,d,s,a,i=i.item,n=o;if(gcWidgets.hoveredSidebar=null,i.hasClass("deleting"))return gcWidgets.save(i,1,0,1),void i.remove();t=i.find("input.add_new").val(),d=i.find("input.multi_number").val(),i.attr("style","").removeClass("ui-draggable"),o="",t&&("multi"===t?(i.html(i.html().replace(/<[^<>]+>/g,function(e){return e.replace(/__i__|%i%/g,d)})),i.attr("id",n.replace("__i__",d)),d++,h("div#"+n).find("input.multi_number").val(d)):"single"===t&&(i.attr("id","new-"+n),r="div#"+n),gcWidgets.save(i,0,0,1),i.find("input.add_new").val(""),l.trigger("widget-added",[i])),(n=i.parent()).parent().hasClass("closed")&&(n.parent().removeClass("closed").find(".handlediv").attr("aria-expanded","true"),1<(s=n.children(".widget")).length&&(s=s.get(0),a=i.get(0),s.id&&a.id&&s.id!==a.id&&h(s).before(i))),t?i.find(".widget-action").trigger("click"):gcWidgets.saveOrder(n.attr("id"))},activate:function(){h(this).parent().addClass("widget-hover")},deactivate:function(){h(this).css("min-height","").parent().removeClass("widget-hover")},receive:function(e,i){i=h(i.sender);-1<this.id.indexOf("orphaned_widgets")?i.sortable("cancel"):-1<i.attr("id").indexOf("orphaned_widgets")&&!i.children(".widget").length&&i.parents(".orphan-sidebar").slideUp(400,function(){h(this).remove()})}}).sortable("option","connectWith","div.widgets-sortables"),h("#available-widgets").droppable({tolerance:"pointer",accept:function(e){return"widget-list"!==h(e).parent().attr("id")},drop:function(e,i){i.draggable.addClass("deleting"),h("#removing-widget").hide().children("span").empty()},over:function(e,i){i.draggable.addClass("deleting"),h("div.widget-placeholder").hide(),i.draggable.hasClass("ui-sortable-helper")&&h("#removing-widget").show().children("span").html(i.draggable.find("div.widget-title").children("h3").html())},out:function(e,i){i.draggable.removeClass("deleting"),h("div.widget-placeholder").show(),h("#removing-widget").hide().children("span").empty()}}),h("#widgets-right .widgets-holder-wrap").each(function(e,i){var i=h(i),t=i.find(".sidebar-name h2").text()||"",d=i.find(".sidebar-name").data("add-to"),i=i.find(".widgets-sortables").attr("id"),s=h("<li>"),d=h("<button>",{type:"button","aria-pressed":"false",class:"widgets-chooser-button","aria-label":d}).text(t.toString().trim());s.append(d),0===e&&(s.addClass("widgets-chooser-selected"),d.attr("aria-pressed","true")),a.append(s),s.data("sidebarId",i)}),h("#available-widgets .widget .widget-top").on("click.widgets-chooser",function(){var e=h(this).closest(".widget"),i=h(this).find(".widget-action"),t=a.find(".widgets-chooser-button");e.hasClass("widget-in-question")||h("#widgets-left").hasClass("chooser")?(i.attr("aria-expanded","false"),c.closeChooser()):(c.clearWidgetSelection(),h("#widgets-left").addClass("chooser"),e.addClass("widget-in-question").children(".widget-description").after(d),d.slideDown(300,function(){i.attr("aria-expanded","true")}),t.on("click.widgets-chooser",function(){a.find(".widgets-chooser-selected").removeClass("widgets-chooser-selected"),t.attr("aria-pressed","false"),h(this).attr("aria-pressed","true").closest("li").addClass("widgets-chooser-selected")}))}),d.on("click.widgets-chooser",function(e){e=h(e.target);e.hasClass("button-primary")?(c.addWidget(d),c.closeChooser()):e.hasClass("widgets-chooser-cancel")&&c.closeChooser()}).on("keyup.widgets-chooser",function(e){e.which===h.ui.keyCode.ESCAPE&&c.closeChooser()})},saveOrder:function(e){var i={action:"widgets-order",savewidgets:h("#_gcnonce_widgets").val(),sidebars:[]};e&&h("#"+e).find(".spinner:first").addClass("is-active"),h("div.widgets-sortables").each(function(){h(this).sortable&&(i["sidebars["+h(this).attr("id")+"]"]=h(this).sortable("toArray").join(","))}),h.post(ajaxurl,i,function(){h("#inactive-widgets-control-remove").prop("disabled",!h("#gc_inactive_widgets .widget").length),h(".spinner").removeClass("is-active")})},save:function(t,d,s,a){var n=this,r=t.closest("div.widgets-sortables").attr("id"),e=t.find("form"),i=t.find("input.add_new").val();(d||i||!e.prop("checkValidity")||e[0].checkValidity())&&(i=e.serialize(),t=h(t),h(".spinner",t).addClass("is-active"),e={action:"save-widget",savewidgets:h("#_gcnonce_widgets").val(),sidebar:r},d&&(e.delete_widget=1),i+="&"+h.param(e),h.post(ajaxurl,i,function(e){var i=h("input.widget-id",t).val();d?(h("input.widget_number",t).val()||h("#available-widgets").find("input.widget-id").each(function(){h(this).val()===i&&h(this).closest("div.widget").show()}),s?(a=0,t.slideUp("fast",function(){h(this).remove(),gcWidgets.saveOrder(),delete n.dirtyWidgets[i]})):(t.remove(),delete n.dirtyWidgets[i],"gc_inactive_widgets"===r&&h("#inactive-widgets-control-remove").prop("disabled",!h("#gc_inactive_widgets .widget").length))):(h(".spinner").removeClass("is-active"),e&&2<e.length&&(h("div.widget-content",t).html(e),gcWidgets.appendTitle(t),t.find(".widget-control-save").prop("disabled",!0).val(gc.i18n.__("\u5df2\u4fdd\u5b58")),t.removeClass("widget-dirty"),delete n.dirtyWidgets[i],l.trigger("widget-updated",[t]),"gc_inactive_widgets"===r&&h("#inactive-widgets-control-remove").prop("disabled",!h("#gc_inactive_widgets .widget").length))),a&&gcWidgets.saveOrder()}))},removeInactiveWidgets:function(){var e,i=h(".remove-inactive-widgets"),t=this;h(".spinner",i).addClass("is-active"),e={action:"delete-inactive-widgets",removeinactivewidgets:h("#_gcnonce_remove_inactive_widgets").val()},e=h.param(e),h.post(ajaxurl,e,function(){h("#gc_inactive_widgets .widget").each(function(){var e=h(this);delete t.dirtyWidgets[e.find("input.widget-id").val()],e.remove()}),h("#inactive-widgets-control-remove").prop("disabled",!0),h(".spinner",i).removeClass("is-active")})},appendTitle:function(e){var i=(i=h('input[id*="-title"]',e).val()||"")&&": "+i.replace(/<[^<>]+>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;");h(e).children(".widget-top").children(".widget-title").children().children(".in-widget-title").html(i)},close:function(e){e.children(".widget-inside").slideUp("fast",function(){e.attr("style","").find(".widget-top button.widget-action").attr("aria-expanded","false").focus()})},addWidget:function(e){var i,e=e.find(".widgets-chooser-selected").data("sidebarId"),e=h("#"+e),t=h("#available-widgets").find(".widget-in-question").clone(),d=t.attr("id"),s=t.find("input.add_new").val(),a=t.find("input.multi_number").val();t.find(".widgets-chooser").remove(),"multi"===s?(t.html(t.html().replace(/<[^<>]+>/g,function(e){return e.replace(/__i__|%i%/g,a)})),t.attr("id",d.replace("__i__",a)),a++,h("#"+d).find("input.multi_number").val(a)):"single"===s&&(t.attr("id","new-"+d),h("#"+d).hide()),e.closest(".widgets-holder-wrap").removeClass("closed").find(".handlediv").attr("aria-expanded","true"),e.append(t),e.sortable("refresh"),gcWidgets.save(t,0,0,1),t.find("input.add_new").val(""),l.trigger("widget-added",[t]),d=(s=h(window).scrollTop())+h(window).height(),(i=e.offset()).bottom=i.top+e.outerHeight(),(s>i.bottom||d<i.top)&&h("html, body").animate({scrollTop:i.top-130},200),window.setTimeout(function(){t.find(".widget-title").trigger("click"),window.gc.a11y.speak(gc.i18n.__("\u5c0f\u5de5\u5177\u5df2\u88ab\u52a0\u5165\u6240\u9009\u7684\u4fa7\u680f"),"assertive")},250)},closeChooser:function(){var e=this,i=h("#available-widgets .widget-in-question");h(".widgets-chooser").slideUp(200,function(){h("#gcbody-content").append(this),e.clearWidgetSelection(),i.find(".widget-action").attr("aria-expanded","false").focus()})},clearWidgetSelection:function(){h("#widgets-left").removeClass("chooser"),h(".widget-in-question").removeClass("widget-in-question")},closeSidebar:function(e){this.hoveredSidebar.addClass("closed").find(".handlediv").attr("aria-expanded","false"),h(e.target).css("min-height",""),this.hoveredSidebar=null}},h(function(){gcWidgets.init()})}(jQuery),gcWidgets.l10n=gcWidgets.l10n||{save:"",saved:"",saveAlert:"",widgetAdded:""},gcWidgets.l10n=window.gc.deprecateL10nObject("gcWidgets.l10n",gcWidgets.l10n,"5.5.0");