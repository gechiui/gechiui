/*! This file is auto-generated */
this.gc=this.gc||{},this.gc.listReusableBlocks=function(n){var o={};function r(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}return r.m=n,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="sRIM")}({YLtl:function(e,t){e.exports=window.lodash},dMTb:function(e,t){e.exports=window.gc.compose},ewfG:function(e,t){e.exports=window.gc.element},jd0n:function(e,t){e.exports=window.gc.components},sRIM:function(e,t,n){"use strict";n.r(t);var r=n("ewfG"),i=n("z4sU"),s=n("YLtl"),t=n("xuem"),a=n.n(t);var o=async function(e){var t=await a()({path:"/gc/v2/types/gc_block"}),e=(t=await a()({path:`/gc/v2/${t.rest_base}/${e}?context=edit`})).title.raw,t=t.content.raw,t=JSON.stringify({__file:"gc_block",title:e,content:t},null,2),e=Object(s.kebabCase)(e)+".json",n="application/json";if(t=new window.Blob([t],{type:n}),window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(t,e);else{const o=document.createElement("a");o.href=URL.createObjectURL(t),o.download=e,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}},c=n("jd0n"),t=n("dMTb");var l=async function(e){e=await function(t){const n=new window.FileReader;return new Promise(e=>{n.onload=()=>{e(n.result)},n.readAsText(t)})}(e);let t;try{t=JSON.parse(e)}catch(e){throw new Error("Invalid JSON file")}if("gc_block"===t.__file&&t.title&&t.content&&Object(s.isString)(t.title)&&Object(s.isString)(t.content))return e=await a()({path:"/gc/v2/types/gc_block"}),await a()({path:"/gc/v2/"+e.rest_base,data:{title:t.title,content:t.content,status:"publish"},method:"POST"});throw new Error("\u65e0\u6548\u7684\u53ef\u91cd\u7528\u533a\u5757 JSON \u6587\u4ef6")};class u extends r.Component{constructor(){super(...arguments),this.state={isLoading:!1,error:null,file:null},this.isStillMounted=!0,this.onChangeFile=this.onChangeFile.bind(this),this.onSubmit=this.onSubmit.bind(this)}componentWillUnmount(){this.isStillMounted=!1}onChangeFile(e){this.setState({file:e.target.files[0],error:null})}onSubmit(e){e.preventDefault();e=this.state.file;const t=this.props["onUpload"];e&&(this.setState({isLoading:!0}),l(e).then(e=>{this.isStillMounted&&(this.setState({isLoading:!1}),t(e))}).catch(t=>{if(this.isStillMounted){let e;switch(t.message){case"Invalid JSON file":e=Object(i.__)("\u65e0\u6548\u7684JSON\u6587\u4ef6");break;case"\u65e0\u6548\u7684\u53ef\u91cd\u7528\u533a\u5757 JSON \u6587\u4ef6":e=Object(i.__)("\u65e0\u6548\u7684\u53ef\u91cd\u7528\u533a\u5757 JSON \u6587\u4ef6");break;default:e=Object(i.__)("\u672a\u77e5\u9519\u8bef")}this.setState({isLoading:!1,error:e})}}))}onDismissError(){this.setState({error:null})}render(){var e=this.props["instanceId"],{file:t,isLoading:n,error:o}=this.state,e="list-reusable-blocks-import-form-"+e;return Object(r.createElement)("form",{className:"list-reusable-blocks-import-form",onSubmit:this.onSubmit},o&&Object(r.createElement)(c.Notice,{status:"error",onRemove:()=>this.onDismissError()},o),Object(r.createElement)("label",{htmlFor:e,className:"list-reusable-blocks-import-form__label"},Object(i.__)("\u6587\u4ef6")),Object(r.createElement)("input",{id:e,type:"file",onChange:this.onChangeFile}),Object(r.createElement)(c.Button,{type:"submit",isBusy:n,disabled:!t||n,variant:"secondary",className:"list-reusable-blocks-import-form__button"},Object(i._x)("\u5bfc\u5165","button label")))}}var d=Object(t.withInstanceId)(u);function b(e){let t=e["onUpload"];return Object(r.createElement)(c.Dropdown,{position:"bottom right",contentClassName:"list-reusable-blocks-import-dropdown__content",renderToggle:e=>{var{isOpen:e,onToggle:t}=e;return Object(r.createElement)(c.Button,{"aria-expanded":e,onClick:t,variant:"primary"},Object(i.__)("\u4eceJSON\u5bfc\u5165"))},renderContent:e=>{e=e.onClose;return Object(r.createElement)(d,{onUpload:Object(s.flow)(e,t)})}})}document.body.addEventListener("click",e=>{e.target.classList.contains("gc-list-reusable-blocks__export")&&(e.preventDefault(),o(e.target.dataset.id))}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".page-title-action");if(e){const t=document.createElement("div");t.className="list-reusable-blocks__container",e.parentNode.insertBefore(t,e),Object(r.render)(Object(r.createElement)(b,{onUpload:()=>{const e=document.createElement("div"),t=(e.className="notice notice-success is-dismissible",e.innerHTML=`<p>${Object(i.__)("\u6210\u529f\u5bfc\u5165\u53ef\u91cd\u7528\u533a\u5757\uff01")}</p>`,document.querySelector(".gc-header-end"));t&&t.parentNode.insertBefore(e,t)}}),t)}})},xuem:function(e,t){e.exports=window.gc.apiFetch},z4sU:function(e,t){e.exports=window.gc.i18n}});