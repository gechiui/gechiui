/*! This file is auto-generated */
!function(){"use strict";var o={d:function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},e={},t=(o.r(e),o.d(e,{ReusableBlocksMenuItems:function(){return g},store:function(){return v}}),{}),n=(o.r(t),o.d(t,{__experimentalConvertBlockToStatic:function(){return c},__experimentalConvertBlocksToReusable:function(){return r},__experimentalDeleteReusableBlock:function(){return l},__experimentalSetEditingReusableBlock:function(){return s}}),{}),b=(o.r(n),o.d(n,{__experimentalIsEditingReusableBlock:function(){return i}}),window.gc.data),k=window.gc.blockEditor,y=window.gc.blocks,B=window.gc.i18n;const c=o=>({registry:e})=>{var t=e.select(k.store).getBlock(o),n=e.select("core").getEditedEntityRecord("postType","gc_block",t.attributes.ref),n=(0,y.parse)("function"==typeof n.content?n.content(n):n.content);e.dispatch(k.store).replaceBlocks(t.clientId,n)},r=(o,c,r)=>async({registry:e,dispatch:t})=>{var n="unsynced"===r?{gc_pattern_sync_status:r}:void 0,n={title:c||(0,B.__)("\u672a\u547d\u540d\u7684\u6837\u677f\u533a\u5757"),content:(0,y.serialize)(e.select(k.store).getBlocksByClientId(o)),status:"publish",meta:n},n=await e.dispatch("core").saveEntityRecord("postType","gc_block",n);"unsynced"!==r&&(n=(0,y.createBlock)("core/block",{ref:n.id}),e.dispatch(k.store).replaceBlocks(o,n),t.__experimentalSetEditingReusableBlock(n.clientId,!0))},l=n=>async({registry:e})=>{var t;e.select("core").getEditedEntityRecord("postType","gc_block",n)&&((t=e.select(k.store).getBlocks().filter(e=>(0,y.isReusableBlock)(e)&&e.attributes.ref===n).map(e=>e.clientId)).length&&e.dispatch(k.store).removeBlocks(t),await e.dispatch("core").deleteEntityRecord("postType","gc_block",n))};function s(e,t){return{type:"SET_EDITING_REUSABLE_BLOCK",clientId:e,isEditing:t}}var a=(0,b.combineReducers)({isEditingReusableBlock:function(e={},t){return"SET_EDITING_REUSABLE_BLOCK"===t?.type?{...e,[t.clientId]:t.isEditing}:e}});function i(e,t){return e.isEditingReusableBlock[t]}const v=(0,b.createReduxStore)("core/reusable-blocks",{actions:t,reducer:a,selectors:n});(0,b.register)(v);var E=window.gc.element,f=window.gc.components,t=window.gc.primitives,w=(0,E.createElement)(t.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,E.createElement)(t.Path,{d:"M21.3 10.8l-5.6-5.6c-.7-.7-1.8-.7-2.5 0l-5.6 5.6c-.7.7-.7 1.8 0 2.5l5.6 5.6c.3.3.8.5 1.2.5s.9-.2 1.2-.5l5.6-5.6c.8-.7.8-1.9.1-2.5zm-1 1.4l-5.6 5.6c-.1.1-.3.1-.4 0l-5.6-5.6c-.1-.1-.1-.3 0-.4l5.6-5.6s.1-.1.2-.1.1 0 .2.1l5.6 5.6c.1.1.1.3 0 .4zm-16.6-.4L10 5.5l-1-1-6.3 6.3c-.7.7-.7 1.8 0 2.5L9 19.5l1.1-1.1-6.3-6.3c-.2 0-.2-.2-.1-.3z"})),h=window.gc.notices,I=window.gc.coreData;const C=(0,window.gc.privateApis.__dangerousOptInToUnstableAPIsOnlyForCoreModules)("I know using unstable features means my plugin or theme will inevitably break on the next GeChiUI release.","@gechiui/reusable-blocks")["unlock"];function u({clientIds:r,rootClientId:l}){const{useReusableBlocksRenameHint:e,ReusableBlocksRenameHint:n}=C(k.privateApis),o=e(),[c,s]=(0,E.useState)(void 0),[a,i]=(0,E.useState)(!1),[u,d]=(0,E.useState)("");var t=(0,b.useSelect)(e=>{var t=e(I.store)["canUser"],{getBlocksByClientId:n,canInsertBlockType:o,getBlockRootClientId:c}=e(k.store),c=l||(0<r.length?c(r[0]):void 0),n=null!=(n=n(r))?n:[];return!(1===n.length&&n[0]&&(0,y.isReusableBlock)(n[0])&&!!e(I.store).getEntityRecord("postType","gc_block",n[0].attributes.ref))&&o("core/block",c)&&n.every(e=>!!e&&e.isValid&&(0,y.hasBlockSupport)(e.name,"reusable",!0))&&!!t("create","blocks")},[r,l]);const p=(0,b.useDispatch)(v)["__experimentalConvertBlocksToReusable"],{createSuccessNotice:g,createErrorNotice:_}=(0,b.useDispatch)(h.store),m=(0,E.useCallback)(async function(e){try{await p(r,e,c),g(c?(0,B.sprintf)((0,B.__)("\u5df2\u521b\u5efa\u672a\u540c\u6b65\u7684\u533a\u5757\u6837\u677f\uff1a%s"),e):(0,B.sprintf)((0,B.__)("\u5df2\u521b\u5efa\u540c\u6b65\u533a\u5757\u6837\u677f\uff1a%s"),e),{type:"snackbar",id:"convert-to-reusable-block-success"})}catch(e){_(e.message,{type:"snackbar",id:"convert-to-reusable-block-error"})}},[p,r,c,g,_]);return t?(0,E.createElement)(k.BlockSettingsMenuControls,null,({onClose:t})=>(0,E.createElement)(E.Fragment,null,(0,E.createElement)(f.MenuItem,{icon:w,onClick:()=>i(!0)},o?(0,B.__)("\u521b\u5efa\u533a\u5757\u6837\u677f/\u53ef\u91cd\u590d\u4f7f\u7528\u533a\u5757"):(0,B.__)("\u521b\u5efa\u6a21\u677f")),a&&(0,E.createElement)(f.Modal,{title:(0,B.__)("\u521b\u5efa\u6a21\u677f"),onRequestClose:()=>{i(!1),d("")},overlayClassName:"reusable-blocks-menu-items__convert-modal"},(0,E.createElement)("form",{onSubmit:e=>{e.preventDefault(),m(u),i(!1),d(""),t()}},(0,E.createElement)(f.__experimentalVStack,{spacing:"5"},(0,E.createElement)(n,null),(0,E.createElement)(f.TextControl,{__nextHasNoMarginBottom:!0,label:(0,B.__)("\u540d\u79f0"),value:u,onChange:d,placeholder:(0,B.__)("\u6211\u7684\u6837\u677f")}),(0,E.createElement)(f.ToggleControl,{label:(0,B.__)("\u5df2\u540c\u6b65"),help:(0,B.__)("\u7f16\u8f91\u56fe\u6848\u5c06\u5728\u4f7f\u7528\u7684\u4efb\u4f55\u4f4d\u7f6e\u8fdb\u884c\u66f4\u65b0\u3002"),checked:!c,onChange:()=>{s(c?void 0:"unsynced")}}),(0,E.createElement)(f.__experimentalHStack,{justify:"right"},(0,E.createElement)(f.Button,{variant:"tertiary",onClick:()=>{i(!1),d("")}},(0,B.__)("\u53d6\u6d88")),(0,E.createElement)(f.Button,{variant:"primary",type:"submit"},(0,B.__)("\u521b\u5efa")))))))):null}var d=window.gc.url;var p=function({clientId:r}){var{canRemove:e,isVisible:t,managePatternsUrl:n}=(0,b.useSelect)(e=>{var{getBlock:t,canRemoveBlock:n,getBlockCount:o,getSettings:c}=e(k.store),e=e(I.store)["canUser"],t=t(r),c=c().__unstableIsBlockBasedTheme;return{canRemove:n(r),isVisible:!!t&&(0,y.isReusableBlock)(t)&&!!e("update","blocks",t.attributes.ref),innerBlockCount:o(r),managePatternsUrl:c&&e("read","templates")?(0,d.addQueryArgs)("site-editor.php",{path:"/patterns"}):(0,d.addQueryArgs)("edit.php",{post_type:"gc_block"})}},[r]);const o=(0,b.useDispatch)(v)["__experimentalConvertBlockToStatic"];return t?(0,E.createElement)(k.BlockSettingsMenuControls,null,(0,E.createElement)(f.MenuItem,{href:n},(0,B.__)("\u7ba1\u7406\u6837\u677f")),e&&(0,E.createElement)(f.MenuItem,{onClick:()=>o(r)},(0,B.__)("\u62c6\u5206\u6a21\u677f"))):null};function g({rootClientId:e}){var t=(0,b.useSelect)(e=>e(k.store).getSelectedBlockClientIds(),[]);return(0,E.createElement)(E.Fragment,null,(0,E.createElement)(u,{clientIds:t,rootClientId:e}),1===t.length&&(0,E.createElement)(p,{clientId:t[0]}))}(window.gc=window.gc||{}).reusableBlocks=e}();