/*! This file is auto-generated */
!function(){"use strict";var a={n:function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},d:function(e,t){for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},e={},t=(a.r(e),a.d(e,{MediaUpload:function(){return o},uploadMedia:function(){return n}}),window.gc.element),v=window.gc.i18n;const l=[],r=i=>{return["sizes","mime","type","subtype","id","url","alt","link","caption"].reduce((e,t)=>(i?.hasOwnProperty(t)&&(e[t]=i[t]),e),{})},s=e=>{var t=window["gc"];return t.media.query({order:"ASC",orderby:"post__in",post__in:e,posts_per_page:-1,query:!0,type:"image"})};class i extends t.Component{constructor({allowedTypes:e,gallery:t=!1,unstableFeaturedImageFlow:i=!1,modalClass:a,multiple:r=!1,title:o=(0,v.__)("\u9009\u62e9\u6216\u4e0a\u4f20\u5a92\u4f53")}){super(...arguments),this.openModal=this.openModal.bind(this),this.onOpen=this.onOpen.bind(this),this.onSelect=this.onSelect.bind(this),this.onUpdate=this.onUpdate.bind(this),this.onClose=this.onClose.bind(this);var l=window["gc"];t?this.buildAndSetGalleryFrame():(t={title:o,multiple:r},e&&(t.library={type:e}),this.frame=l.media(t)),a&&this.frame.$el.addClass(a),i&&this.buildAndSetFeatureImageFrame(),this.initializeListeners()}initializeListeners(){this.frame.on("select",this.onSelect),this.frame.on("update",this.onUpdate),this.frame.on("open",this.onOpen),this.frame.on("close",this.onClose)}buildAndSetGalleryFrame(){var{addToGallery:t=!1,allowedTypes:i,multiple:a=!1,value:r=l}=this.props;if(r!==this.lastGalleryValue){var o=window["gc"];this.lastGalleryValue=r,this.frame&&this.frame.remove();let e;e=t?"gallery-library":r&&r.length?"gallery-edit":"gallery",this.GalleryDetailsMediaFrame||(this.GalleryDetailsMediaFrame=(()=>{const t=window["gc"];return t.media.view.MediaFrame.Post.extend({galleryToolbar(){var e=this.state().get("editing");this.toolbar.set(new t.media.view.Toolbar({controller:this,items:{insert:{style:"primary",text:e?t.media.view.l10n.updateGallery:t.media.view.l10n.insertGallery,priority:80,requires:{library:!0},click(){var e=this.controller,t=e.state();e.close(),t.trigger("update",t.get("library")),e.setState(e.options.state),e.reset()}}}}))},editState(){var e=this.state("gallery").get("selection"),e=new t.media.view.EditImage({model:e.single(),controller:this}).render();this.content.set(e),e.loadEditor()},createStates:function(){this.on("toolbar:create:main-gallery",this.galleryToolbar,this),this.on("content:render:edit-image",this.editState,this),this.states.add([new t.media.controller.Library({id:"gallery",title:t.media.view.l10n.createGalleryTitle,priority:40,toolbar:"main-gallery",filterable:"uploaded",multiple:"add",editable:!1,library:t.media.query({type:"image",...this.options.library})}),new t.media.controller.EditImage({model:this.options.editImage}),new t.media.controller.GalleryEdit({library:this.options.selection,editing:this.options.editing,menu:"gallery",displaySettings:!1,multiple:!0}),new t.media.controller.GalleryAdd])}})})());t=s(r),t=new o.media.model.Selection(t.models,{props:t.props.toJSON(),multiple:a});this.frame=new this.GalleryDetailsMediaFrame({mimeType:i,state:e,multiple:a,selection:t,editing:!(!r||!r.length)}),o.media.frame=this.frame,this.initializeListeners()}}buildAndSetFeatureImageFrame(){var e=window["gc"],t=(()=>{const t=window["gc"];return t.media.view.MediaFrame.Select.extend({featuredImageToolbar(e){this.createSelectToolbar(e,{text:t.media.view.l10n.setFeaturedImage,state:this.options.state})},editState(){var e=this.state("featured-image").get("selection"),e=new t.media.view.EditImage({model:e.single(),controller:this}).render();this.content.set(e),e.loadEditor()},createStates:function(){this.on("toolbar:create:featured-image",this.featuredImageToolbar,this),this.on("content:render:edit-image",this.editState,this),this.states.add([new t.media.controller.FeaturedImage,new t.media.controller.EditImage({model:this.options.editImage})])}})})(),i=s(this.props.value),i=new e.media.model.Selection(i.models,{props:i.props.toJSON()});this.frame=new t({mimeType:this.props.allowedTypes,state:"featured-image",multiple:this.props.multiple,selection:i,editing:!!this.props.value}),e.media.frame=this.frame}componentWillUnmount(){this.frame.remove()}onUpdate(e){var{onSelect:t,multiple:i=!1}=this.props,a=this.frame.state(),e=e||a.get("selection");e&&e.models.length&&t(i?e.models.map(e=>r(e.toJSON())):r(e.models[0].toJSON()))}onSelect(){var{onSelect:e,multiple:t=!1}=this.props,i=this.frame.state().get("selection").toJSON();e(t?i:i[0])}onOpen(){const t=window["gc"];var e=this.props["value"],i=(this.updateCollection(),this.props.mode&&this.frame.content.mode(this.props.mode),Array.isArray(e)?!!e?.length:!!e);if(i){const a=this.props.gallery,r=this.frame.state().get("selection");i=Array.isArray(e)?e:[e];a||i.forEach(e=>{r.add(t.media.attachment(e))});const o=s(i);o.more().done(function(){a&&o?.models?.length&&r.add(o.models)})}}onClose(){var e=this.props["onClose"];e&&e()}updateCollection(){var e=this.frame.content.get();e&&e.collection&&((e=e.collection).toArray().forEach(e=>e.trigger("destroy",e)),e.mirroring._hasMore=!0,e.more())}openModal(){this.props.gallery&&this.buildAndSetGalleryFrame(),this.frame.open()}render(){return this.props.render({open:this.openModal})}}var o=i,t=window.gc.apiFetch,S=a.n(t),_=window.gc.blob;const T=()=>{};async function n({allowedTypes:e,additionalData:t={},filesList:i,maxUploadFileSize:a,onError:r=T,onFileChange:o,gcAllowedMimeTypes:l=null}){i=[...i];const s=[];var n=(e,t)=>{(0,_.revokeBlobURL)(s[e]?.url),s[e]=t,o(s.filter(Boolean))};const d=(l=l)&&Object.entries(l).map(([e,t])=>{const[i]=t.split("/");return[t,...e.split("|").map(e=>i+"/"+e)]}).flat();var m,p=[];for(const y of i)d&&y.type&&(m=y.type,!d.includes(m))?r({code:"MIME_TYPE_NOT_ALLOWED_FOR_USER",message:(0,v.sprintf)((0,v.__)("%s\uff1a\u62b1\u6b49\uff0c\u60a8\u65e0\u6743\u4e0a\u4f20\u6b64\u6587\u4ef6\u7c7b\u578b\u3002"),y.name),file:y}):y.type&&!(t=>!e||e.some(e=>e.includes("/")?e===t:t.startsWith(e+"/")))(y.type)?r({code:"MIME_TYPE_NOT_SUPPORTED",message:(0,v.sprintf)((0,v.__)("%s\uff1a\u62b1\u6b49\uff0c\u4e0d\u652f\u6301\u6b64\u6587\u4ef6\u7c7b\u578b\u3002"),y.name),file:y}):a&&y.size>a?r({code:"SIZE_ABOVE_LIMIT",message:(0,v.sprintf)((0,v.__)("%s\uff1a\u6b64\u6587\u4ef6\u8d85\u8fc7\u4e86\u672c\u7cfb\u7edf\u7684\u6700\u5927\u4e0a\u4f20\u5927\u5c0f\u3002"),y.name),file:y}):y.size<=0?r({code:"EMPTY_FILE",message:(0,v.sprintf)((0,v.__)("%s\uff1a\u6b64\u6587\u4ef6\u4e3a\u7a7a\u3002"),y.name),file:y}):(p.push(y),s.push({url:(0,_.createBlobURL)(y)}),o(s));for(let i=0;i<p.length;++i){var c=p[i];try{var h,u=await function(e,t){const i=new window.FormData;i.append("file",e,e.name||e.type.replace("/",".")),t&&Object.entries(t).forEach(([e,t])=>i.append(e,t));return S()({path:"/gc/v2/media",body:i,method:"POST"})}(c,t);const{alt_text:f,source_url:w,...b}=u;var g={...b,alt:u.alt_text,caption:null!=(h=u.caption?.raw)?h:"",title:u.title.raw,url:u.source_url};n(i,g)}catch(e){n(i,null);let t;r({code:"GENERAL",message:t=e.message||(0,v.sprintf)((0,v.__)("\u5728\u5c06\u6587\u4ef6%s\u4e0a\u4f20\u81f3\u5a92\u4f53\u5e93\u65f6\u51fa\u73b0\u9519\u8bef\u3002"),c.name),file:c})}}}(window.gc=window.gc||{}).mediaUtils=e}();