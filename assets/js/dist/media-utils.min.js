/*! This file is auto-generated */
this.gc=this.gc||{},this.gc.mediaUtils=function(i){var a={};function o(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}return o.m=i,o.c=a,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(i,a,function(e){return t[e]}.bind(null,a));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s="/+yF")}({"/+yF":function(e,t,i){"use strict";i.r(t),i.d(t,"MediaUpload",function(){return o}),i.d(t,"uploadMedia",function(){return d});var O=i("YLtl"),w=i("ewfG"),v=i("z4sU");const s=window["gc"],r=[],l=e=>{return Object(O.pick)(e,["sizes","mime","type","subtype","id","url","alt","link","caption"])},n=e=>s.media.query({order:"ASC",orderby:"post__in",post__in:e,posts_per_page:-1,query:!0,type:"image"});class a extends w.Component{constructor(e){var{allowedTypes:e,gallery:t=!1,unstableFeaturedImageFlow:i=!1,modalClass:a,multiple:o=!1,title:l=Object(v.__)("\u9009\u62e9\u6216\u4e0a\u4f20\u5a92\u4f53")}=e;if(super(...arguments),this.openModal=this.openModal.bind(this),this.onOpen=this.onOpen.bind(this),this.onSelect=this.onSelect.bind(this),this.onUpdate=this.onUpdate.bind(this),this.onClose=this.onClose.bind(this),t)this.buildAndSetGalleryFrame();else{const r={title:l,multiple:o};e&&(r.library={type:e}),this.frame=s.media(r)}a&&this.frame.$el.addClass(a),i&&this.buildAndSetFeatureImageFrame(),this.initializeListeners()}initializeListeners(){this.frame.on("select",this.onSelect),this.frame.on("update",this.onUpdate),this.frame.on("open",this.onOpen),this.frame.on("close",this.onClose)}buildAndSetGalleryFrame(){var{addToGallery:t=!1,allowedTypes:i,multiple:a=!1,value:o=r}=this.props;if(o!==this.lastGalleryValue){this.lastGalleryValue=o,this.frame&&this.frame.remove();let e;e=t?"gallery-library":o&&o.length?"gallery-edit":"gallery",this.GalleryDetailsMediaFrame||(this.GalleryDetailsMediaFrame=s.media.view.MediaFrame.Post.extend({galleryToolbar(){var e=this.state().get("editing");this.toolbar.set(new s.media.view.Toolbar({controller:this,items:{insert:{style:"primary",text:e?s.media.view.l10n.updateGallery:s.media.view.l10n.insertGallery,priority:80,requires:{library:!0},click(){const e=this.controller,t=e.state();e.close(),t.trigger("update",t.get("library")),e.setState(e.options.state),e.reset()}}}}))},editState(){const e=this.state("gallery").get("selection"),t=new s.media.view.EditImage({model:e.single(),controller:this}).render();this.content.set(t),t.loadEditor()},createStates:function(){this.on("toolbar:create:main-gallery",this.galleryToolbar,this),this.on("content:render:edit-image",this.editState,this),this.states.add([new s.media.controller.Library({id:"gallery",title:s.media.view.l10n.createGalleryTitle,priority:40,toolbar:"main-gallery",filterable:"uploaded",multiple:"add",editable:!1,library:s.media.query(Object(O.defaults)({type:"image"},this.options.library))}),new s.media.controller.EditImage({model:this.options.editImage}),new s.media.controller.GalleryEdit({library:this.options.selection,editing:this.options.editing,menu:"gallery",displaySettings:!1,multiple:!0}),new s.media.controller.GalleryAdd])}}));const l=n(o);t=new s.media.model.Selection(l.models,{props:l.props.toJSON(),multiple:a});this.frame=new this.GalleryDetailsMediaFrame({mimeType:i,state:e,multiple:a,selection:t,editing:!(!o||!o.length)}),s.media.frame=this.frame,this.initializeListeners()}}buildAndSetFeatureImageFrame(){const e=s.media.view.MediaFrame.Select.extend({featuredImageToolbar(e){this.createSelectToolbar(e,{text:s.media.view.l10n.setFeaturedImage,state:this.options.state})},editState(){const e=this.state("featured-image").get("selection"),t=new s.media.view.EditImage({model:e.single(),controller:this}).render();this.content.set(t),t.loadEditor()},createStates:function(){this.on("toolbar:create:featured-image",this.featuredImageToolbar,this),this.on("content:render:edit-image",this.editState,this),this.states.add([new s.media.controller.FeaturedImage,new s.media.controller.EditImage({model:this.options.editImage})])}}),t=n(this.props.value);var i=new s.media.model.Selection(t.models,{props:t.props.toJSON()});this.frame=new e({mimeType:this.props.allowedTypes,state:"featured-image",multiple:this.props.multiple,selection:i,editing:!!this.props.value}),s.media.frame=this.frame}componentWillUnmount(){this.frame.remove()}onUpdate(e){const{onSelect:t,multiple:i=!1}=this.props,a=this.frame.state(),o=e||a.get("selection");o&&o.models.length&&(i?t(o.models.map(e=>l(e.toJSON()))):t(l(o.models[0].toJSON())))}onSelect(){const{onSelect:e,multiple:t=!1}=this.props;var i=this.frame.state().get("selection").toJSON();e(t?i:i[0])}onOpen(){this.updateCollection();var e=Array.isArray(this.props.value)?!(null==(e=this.props.value)||!e.length):!!this.props.value;if(e){const t=this.props.gallery,i=this.frame.state().get("selection"),a=(t||Object(O.castArray)(this.props.value).forEach(e=>{i.add(s.media.attachment(e))}),n(Object(O.castArray)(this.props.value)));a.more().done(function(){var e;t&&null!==a&&void 0!==a&&null!=(e=a.models)&&e.length&&i.add(a.models)})}}onClose(){const e=this.props["onClose"];e&&e()}updateCollection(){var e=this.frame.content.get();if(e&&e.collection){const t=e.collection;t.toArray().forEach(e=>e.trigger("destroy",e)),t.mirroring._hasMore=!0,t.more()}}openModal(){this.props.gallery&&this.buildAndSetGalleryFrame(),this.frame.open()}render(){return this.props.render({open:this.openModal})}}var o=a,t=i("xuem"),_=i.n(t),S=i("8mya");async function d(e){let{allowedTypes:i,additionalData:t={},filesList:a,maxUploadFileSize:o,onError:l=O.noop,onFileChange:r,gcAllowedMimeTypes:s=null}=e;e=[...a];const n=[];var d,c=(e,t)=>{Object(S.revokeBlobURL)(Object(O.get)(n,[e,"url"])),n[e]=t,r(Object(O.compact)(n))};const m=(d=s)&&Object(O.flatMap)(d,(e,t)=>{const[i]=e.split("/");t=t.split("|");return[e,...Object(O.map)(t,e=>i+"/"+e)]});var p,u=e=>{e.message=[Object(w.createElement)("strong",{key:"filename"},e.file.name),": ",e.message],l(e)};const h=[];for(const b of e)m&&b.type&&(p=b.type,!Object(O.includes)(m,p))?u({code:"MIME_TYPE_NOT_ALLOWED_FOR_USER",message:Object(v.__)("\u62b1\u6b49\uff0c\u60a8\u65e0\u6743\u4e0a\u4f20\u6b64\u6587\u4ef6\u7c7b\u578b\u3002"),file:b}):b.type&&!(t=>!i||Object(O.some)(i,e=>Object(O.includes)(e,"/")?e===t:Object(O.startsWith)(t,e+"/")))(b.type)?u({code:"MIME_TYPE_NOT_SUPPORTED",message:Object(v.__)("\u62b1\u6b49\uff0c\u4e0d\u652f\u6301\u6b64\u6587\u4ef6\u7c7b\u578b\u3002"),file:b}):o&&b.size>o?u({code:"SIZE_ABOVE_LIMIT",message:Object(v.__)("\u6b64\u6587\u4ef6\u8d85\u8fc7\u4e86\u672c\u7ad9\u70b9\u7684\u6700\u5927\u4e0a\u4f20\u5927\u5c0f\u3002"),file:b}):b.size<=0?u({code:"EMPTY_FILE",message:Object(v.__)("\u6b64\u6587\u4ef6\u4e3a\u7a7a\u3002"),file:b}):(h.push(b),n.push({url:Object(S.createBlobURL)(b)}),r(n));for(let i=0;i<h.length;++i){var g=h[i];try{var f=await function(e,t){const i=new window.FormData;return i.append("file",e,e.name||e.type.replace("/",".")),Object(O.forEach)(t,(e,t)=>i.append(t,e)),_()({path:"/gc/v2/media",body:i,method:"POST"})}(g,t),y={...Object(O.omit)(f,["alt_text","source_url"]),alt:f.alt_text,caption:Object(O.get)(f,["caption","raw"],""),title:f.title.raw,url:f.source_url};c(i,y)}catch(e){c(i,null);let t;t=Object(O.has)(e,["message"])?Object(O.get)(e,["message"]):Object(v.sprintf)(Object(v.__)("\u5728\u5c06\u6587\u4ef6%s\u4e0a\u4f20\u81f3\u5a92\u4f53\u5e93\u65f6\u51fa\u73b0\u9519\u8bef\u3002"),g.name),l({code:"GENERAL",message:t,file:g})}}}},"8mya":function(e,t){e.exports=window.gc.blob},YLtl:function(e,t){e.exports=window.lodash},ewfG:function(e,t){e.exports=window.gc.element},xuem:function(e,t){e.exports=window.gc.apiFetch},z4sU:function(e,t){e.exports=window.gc.i18n}});