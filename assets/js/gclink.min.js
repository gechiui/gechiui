/*! This file is auto-generated */
!function(r,s,l){var o,e,t,n,i,h=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,63}$/i,u=/^(https?|ftp):\/\/[A-Z0-9.-]+\.[A-Z]{2,63}[^ "]*$/i,g={},a={},c="ontouchend"in document;function d(){return o?o.$('a[data-gclink-edit="true"]'):null}window.gcLink={timeToTriggerRiver:150,minRiverAJAXDuration:200,riverBottomThreshold:5,keySensitivity:100,lastSearch:"",textarea:"",modalOpen:!1,init:function(){g.wrap=r("#gc-link-wrap"),g.dialog=r("#gc-link"),g.backdrop=r("#gc-link-backdrop"),g.submit=r("#gc-link-submit"),g.close=r("#gc-link-close"),g.text=r("#gc-link-text"),g.url=r("#gc-link-url"),g.nonce=r("#_ajax_linking_nonce"),g.openInNewTab=r("#gc-link-target"),g.search=r("#gc-link-search"),a.search=new t(r("#search-results")),a.recent=new t(r("#most-recent-results")),a.elements=g.dialog.find(".query-results"),g.queryNotice=r("#query-notice-message"),g.queryNoticeTextDefault=g.queryNotice.find(".query-notice-default"),g.queryNoticeTextHint=g.queryNotice.find(".query-notice-hint"),g.dialog.on("keydown",gcLink.keydown),g.dialog.on("keyup",gcLink.keyup),g.submit.on("click",function(e){e.preventDefault(),gcLink.update()}),g.close.add(g.backdrop).add("#gc-link-cancel button").on("click",function(e){e.preventDefault(),gcLink.close()}),a.elements.on("river-select",gcLink.updateFields),g.search.on("focus.gclink",function(){g.queryNoticeTextDefault.hide(),g.queryNoticeTextHint.removeClass("screen-reader-text").show()}).on("blur.gclink",function(){g.queryNoticeTextDefault.show(),g.queryNoticeTextHint.addClass("screen-reader-text").hide()}),g.search.on("keyup input",function(){window.clearTimeout(e),e=window.setTimeout(function(){gcLink.searchInternalLinks()},500)}),g.url.on("paste",function(){setTimeout(gcLink.correctURL,0)}),g.url.on("blur",gcLink.correctURL)},correctURL:function(){var e=g.url.val().trim();e&&i!==e&&!/^(?:[a-z]+:|#|\?|\.|\/)/.test(e)&&(g.url.val("http://"+e),i=e)},open:function(e,t,n){var i=r(document.body);i.addClass("modal-open"),gcLink.modalOpen=!0,gcLink.range=null,e&&(window.gcActiveEditor=e),window.gcActiveEditor&&(this.textarea=r("#"+window.gcActiveEditor).get(0),void 0!==window.tinymce&&(i.append(g.backdrop,g.wrap),e=window.tinymce.get(window.gcActiveEditor),o=e&&!e.isHidden()?e:null),!gcLink.isMCE()&&document.selection&&(this.textarea.focus(),this.range=document.selection.createRange()),g.wrap.show(),g.backdrop.show(),gcLink.refresh(t,n),r(document).trigger("gclink-open",g.wrap))},isMCE:function(){return o&&!o.isHidden()},refresh:function(e,t){a.search.refresh(),a.recent.refresh(),gcLink.isMCE()?gcLink.mceRefresh(e,t):(g.wrap.hasClass("has-text-field")||g.wrap.addClass("has-text-field"),document.selection?document.selection.createRange().text:void 0!==this.textarea.selectionStart&&this.textarea.selectionStart!==this.textarea.selectionEnd&&(t=this.textarea.value.substring(this.textarea.selectionStart,this.textarea.selectionEnd)||t||""),g.text.val(t),gcLink.setDefaultValues()),c?g.url.trigger("focus").trigger("blur"):window.setTimeout(function(){g.url[0].select(),g.url.trigger("focus")}),a.recent.ul.children().length||a.recent.ajax(),i=g.url.val().replace(/^http:\/\//,"")},hasSelectedText:function(e){var t,n,i,a=o.selection.getContent();if(/</.test(a)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(a)||-1===a.indexOf("href=")))return!1;if(e.length){if(!(n=e[0].childNodes)||!n.length)return!1;for(i=n.length-1;0<=i;i--)if(3!=(t=n[i]).nodeType&&!window.tinymce.dom.BookmarkManager.isBookmarkNode(t))return!1}return!0},mceRefresh:function(e,t){var n,i,a=d(),c=this.hasSelectedText(a);a.length?(n=a.text(),i=a.attr("href"),n.trim()||(n=t||""),"_gc_link_placeholder"!==(i=e&&(u.test(e)||h.test(e))?e:i)?(g.url.val(i),g.openInNewTab.prop("checked","_blank"===a.attr("target")),g.submit.val(s.update)):this.setDefaultValues(n),e&&e!==i?g.search.val(e):g.search.val(""),window.setTimeout(function(){gcLink.searchInternalLinks()})):(n=o.selection.getContent({format:"text"})||t||"",this.setDefaultValues(n)),c?(g.text.val(n),g.wrap.addClass("has-text-field")):(g.text.val(""),g.wrap.removeClass("has-text-field"))},close:function(e){r(document.body).removeClass("modal-open"),gcLink.modalOpen=!1,"noReset"!==e&&(gcLink.isMCE()?(o.plugins.gclink&&o.plugins.gclink.close(),o.focus()):(gcLink.textarea.focus(),gcLink.range&&(gcLink.range.moveToBookmark(gcLink.range.getBookmark()),gcLink.range.select()))),g.backdrop.hide(),g.wrap.hide(),i=!1,r(document).trigger("gclink-close",g.wrap)},getAttrs:function(){return gcLink.correctURL(),{href:g.url.val().trim(),target:g.openInNewTab.prop("checked")?"_blank":null}},buildHtml:function(e){var t='<a href="'+e.href+'"';return e.target&&(t+=' rel="noopener" target="'+e.target+'"'),t+">"},update:function(){gcLink.isMCE()?gcLink.mceUpdate():gcLink.htmlUpdate()},htmlUpdate:function(){var e,t,n,i,a,c=gcLink.textarea;c&&(n=gcLink.getAttrs(),i=g.text.val(),(a=document.createElement("a")).href=n.href,"javascript:"!==a.protocol&&"data:"!==a.protocol||(n.href=""),n.href&&(a=gcLink.buildHtml(n),document.selection&&gcLink.range?(c.focus(),gcLink.range.text=a+(i||gcLink.range.text)+"</a>",gcLink.range.moveToBookmark(gcLink.range.getBookmark()),gcLink.range.select(),gcLink.range=null):void 0!==c.selectionStart&&(n=c.selectionStart,e=c.selectionEnd,t=n+(a=a+(i=i||c.value.substring(n,e))+"</a>").length,n!==e||i||(t-=4),c.value=c.value.substring(0,n)+a+c.value.substring(e,c.value.length),c.selectionStart=c.selectionEnd=t),gcLink.close(),c.focus(),r(c).trigger("change"),l.a11y.speak(s.linkInserted)))},mceUpdate:function(){var e,t,n,i=gcLink.getAttrs(),a=document.createElement("a");if(a.href=i.href,"javascript:"!==a.protocol&&"data:"!==a.protocol||(i.href=""),!i.href)return o.execCommand("unlink"),void gcLink.close();e=d(),o.undoManager.transact(function(){e.length||(o.execCommand("mceInsertLink",!1,{href:"_gc_link_placeholder","data-gc-temp-link":1}),e=o.$('a[data-gc-temp-link="1"]').removeAttr("data-gc-temp-link"),n=e.text().trim()),e.length?(g.wrap.hasClass("has-text-field")&&((t=g.text.val())?e.text(t):n||e.text(i.href)),i["data-gclink-edit"]=null,i["data-mce-href"]=i.href,e.attr(i)):o.execCommand("unlink")}),gcLink.close("noReset"),o.focus(),e.length&&(o.selection.select(e[0]),o.plugins.gclink&&o.plugins.gclink.checkLink(e[0])),o.nodeChanged(),l.a11y.speak(s.linkInserted)},updateFields:function(e,t){g.url.val(t.children(".item-permalink").val()),g.wrap.hasClass("has-text-field")&&!g.text.val()&&g.text.val(t.children(".item-title").text())},getUrlFromSelection:function(e){return e||(this.isMCE()?e=o.selection.getContent({format:"text"}):document.selection&&gcLink.range?e=gcLink.range.text:void 0!==this.textarea.selectionStart&&(e=this.textarea.value.substring(this.textarea.selectionStart,this.textarea.selectionEnd))),(e=(e=e||"").trim())&&h.test(e)?"mailto:"+e:e&&u.test(e)?e.replace(/&amp;|&#0?38;/gi,"&"):""},setDefaultValues:function(e){g.url.val(this.getUrlFromSelection(e)),g.search.val(""),gcLink.searchInternalLinks(),g.submit.val(s.save)},searchInternalLinks:function(){var e,t=g.search.val()||"",n=parseInt(s.minInputLength,10)||3;t.length>=n?(a.recent.hide(),a.search.show(),gcLink.lastSearch!=t&&(gcLink.lastSearch=t,e=g.search.parent().find(".spinner").addClass("is-active"),a.search.change(t),a.search.ajax(function(){e.removeClass("is-active")}))):(a.search.hide(),a.recent.show())},next:function(){a.search.next(),a.recent.next()},prev:function(){a.search.prev(),a.recent.prev()},keydown:function(e){var t;27===e.keyCode?(gcLink.close(),e.stopImmediatePropagation()):9===e.keyCode&&("gc-link-submit"!==(t=e.target.id)||e.shiftKey?"gc-link-close"===t&&e.shiftKey&&(g.submit.trigger("focus"),e.preventDefault()):(g.close.trigger("focus"),e.preventDefault())),e.shiftKey||38!==e.keyCode&&40!==e.keyCode||document.activeElement&&("link-title-field"===document.activeElement.id||"url-field"===document.activeElement.id)||(t=38===e.keyCode?"prev":"next",clearInterval(gcLink.keyInterval),gcLink[t](),gcLink.keyInterval=setInterval(gcLink[t],gcLink.keySensitivity),e.preventDefault())},keyup:function(e){38!==e.keyCode&&40!==e.keyCode||(clearInterval(gcLink.keyInterval),e.preventDefault())},delayedCallback:function(e,t){var n,i,a,c;return t?(setTimeout(function(){if(i)return e.apply(c,a);n=!0},t),function(){if(n)return e.apply(this,arguments);a=arguments,c=this,i=!0}):e}},t=function(e,t){var n=this;this.element=e,this.ul=e.children("ul"),this.contentHeight=e.children("#link-selector-height"),this.waiting=e.find(".river-waiting"),this.change(t),this.refresh(),r("#gc-link .query-results, #gc-link #link-selector").on("scroll",function(){n.maybeLoad()}),e.on("click","li",function(e){n.select(r(this),e)})},r.extend(t.prototype,{refresh:function(){this.deselect(),this.visible=this.element.is(":visible")},show:function(){this.visible||(this.deselect(),this.element.show(),this.visible=!0)},hide:function(){this.element.hide(),this.visible=!1},select:function(e,t){var n,i,a,c;e.hasClass("unselectable")||e==this.selected||(this.deselect(),this.selected=e.addClass("selected"),n=e.outerHeight(),i=this.element.height(),a=e.position().top,c=this.element.scrollTop(),a<0?this.element.scrollTop(c+a):i<a+n&&this.element.scrollTop(c+a-i+n),this.element.trigger("river-select",[e,t,this]))},deselect:function(){this.selected&&this.selected.removeClass("selected"),this.selected=!1},prev:function(){var e;this.visible&&this.selected&&(e=this.selected.prev("li")).length&&this.select(e)},next:function(){var e;!this.visible||(e=this.selected?this.selected.next("li"):r("li:not(.unselectable):first",this.element)).length&&this.select(e)},ajax:function(n){var i=this,e=1==this.query.page?0:gcLink.minRiverAJAXDuration,e=gcLink.delayedCallback(function(e,t){i.process(e,t),n&&n(e,t)},e);this.query.ajax(e)},change:function(e){this.query&&this._search==e||(this._search=e,this.query=new n(e),this.element.scrollTop(0))},process:function(e,t){var n,i="",a=!0,t=1==t.page;e?r.each(e,function(){n=a?"alternate":"",n+=this.title?"":" no-title",i=(i=(i=(i+=n?'<li class="'+n+'">':"<li>")+'<input type="hidden" class="item-permalink" value="'+this.permalink+'" /><span class="item-title">')+(this.title||s.noTitle))+'</span><span class="item-info">'+this.info+"</span></li>",a=!a}):t&&(i+='<li class="unselectable no-matches-found"><span class="item-title"><em>'+s.noMatchesFound+"</em></span></li>"),this.ul[t?"html":"append"](i)},maybeLoad:function(){var n=this,i=this.element,e=i.scrollTop()+i.height();!this.query.ready()||e<this.contentHeight.height()-gcLink.riverBottomThreshold||setTimeout(function(){var e=i.scrollTop(),t=e+i.height();!n.query.ready()||t<n.contentHeight.height()-gcLink.riverBottomThreshold||(n.waiting.addClass("is-active"),i.scrollTop(e+n.waiting.outerHeight()),n.ajax(function(){n.waiting.removeClass("is-active")}))},gcLink.timeToTriggerRiver)}}),n=function(e){this.page=1,this.allLoaded=!1,this.querying=!1,this.search=e},r.extend(n.prototype,{ready:function(){return!(this.querying||this.allLoaded)},ajax:function(t){var n=this,i={action:"gc-link-ajax",page:this.page,_ajax_linking_nonce:g.nonce.val()};this.search&&(i.search=this.search),this.querying=!0,r.post(window.ajaxurl,i,function(e){n.page++,n.querying=!1,n.allLoaded=!e,t(e,i)},"json")}}),r(gcLink.init)}(jQuery,window.gcLinkL10n,window.gc);