!function(r){r.fn.farbtastic=function(t){return r.farbtastic(this,t),this},r.farbtastic=function(t,a){return(t=r(t).get(0)).farbtastic||(t.farbtastic=new r._farbtastic(t,a))},r._farbtastic=function(t,a){var e=this,o=(r(t).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>'),r(".farbtastic",t));e.wheel=r(".wheel",t).get(0),e.radius=84,e.square=100,e.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&r("*",o).each(function(){var t;"none"!=this.currentStyle.backgroundImage&&(t=this.currentStyle.backgroundImage,t=this.currentStyle.backgroundImage.substring(5,t.length-2),r(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+t+"')"}))}),e.linkTo=function(t){return"object"==typeof e.callback&&r(e.callback).unbind("keyup",e.updateValue),e.color=null,"function"==typeof t?e.callback=t:"object"!=typeof t&&"string"!=typeof t||(e.callback=r(t),e.callback.bind("keyup",e.updateValue),e.callback.get(0).value&&e.setColor(e.callback.get(0).value)),this},e.updateValue=function(t){this.value&&this.value!=e.color&&e.setColor(this.value)},e.setColor=function(t){var a=e.unpack(t);return e.color!=t&&a&&(e.color=t,e.rgb=a,e.hsl=e.RGBToHSL(e.rgb),e.updateDisplay()),this},e.setHSL=function(t){return e.hsl=t,e.rgb=e.HSLToRGB(t),e.color=e.pack(e.rgb),e.updateDisplay(),this},e.widgetCoords=function(t){var a=r(e.wheel).offset();return{x:t.pageX-a.left-e.width/2,y:t.pageY-a.top-e.width/2}},e.mousedown=function(t){document.dragging||(r(document).bind("mousemove",e.mousemove).bind("mouseup",e.mouseup),document.dragging=!0);var a=e.widgetCoords(t);return e.circleDrag=2*Math.max(Math.abs(a.x),Math.abs(a.y))>e.square,e.mousemove(t),!1},e.mousemove=function(t){var a,t=e.widgetCoords(t);return e.circleDrag?((a=Math.atan2(t.x,-t.y)/6.28)<0&&(a+=1),e.setHSL([a,e.hsl[1],e.hsl[2]])):(a=Math.max(0,Math.min(1,.5-t.x/e.square)),t=Math.max(0,Math.min(1,.5-t.y/e.square)),e.setHSL([e.hsl[0],a,t])),!1},e.mouseup=function(){r(document).unbind("mousemove",e.mousemove),r(document).unbind("mouseup",e.mouseup),document.dragging=!1},e.updateDisplay=function(){var t=6.28*e.hsl[0];r(".h-marker",o).css({left:Math.round(Math.sin(t)*e.radius+e.width/2)+"px",top:Math.round(-Math.cos(t)*e.radius+e.width/2)+"px"}),r(".sl-marker",o).css({left:Math.round(e.square*(.5-e.hsl[1])+e.width/2)+"px",top:Math.round(e.square*(.5-e.hsl[2])+e.width/2)+"px"}),r(".color",o).css("backgroundColor",e.pack(e.HSLToRGB([e.hsl[0],1,.5]))),"object"==typeof e.callback?(r(e.callback).css({backgroundColor:e.color,color:.5<e.hsl[2]?"#000":"#fff"}),r(e.callback).each(function(){this.value&&this.value!=e.color&&(this.value=e.color)})):"function"==typeof e.callback&&e.callback.call(e,e.color)},e.pack=function(t){var a=Math.round(255*t[0]),e=Math.round(255*t[1]),t=Math.round(255*t[2]);return"#"+(a<16?"0":"")+a.toString(16)+(e<16?"0":"")+e.toString(16)+(t<16?"0":"")+t.toString(16)},e.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},e.HSLToRGB=function(t){var a=t[0],e=t[1],t=t[2],e=t<=.5?t*(e+1):t+e-t*e,t=2*t-e;return[this.hueToRGB(t,e,a+.33333),this.hueToRGB(t,e,a),this.hueToRGB(t,e,a-.33333)]},e.hueToRGB=function(t,a,e){return 6*(e=e<0?e+1:1<e?e-1:e)<1?t+(a-t)*e*6:2*e<1?a:3*e<2?t+(a-t)*(.66666-e)*6:t},e.RGBToHSL=function(t){var a=t[0],e=t[1],t=t[2],o=Math.min(a,Math.min(e,t)),r=Math.max(a,Math.max(e,t)),n=r-o,o=(o+r)/2,s=0;return 0<n&&(r==a&&r!=e&&(s+=(e-t)/n),r==e&&r!=t&&(s+=2+(t-a)/n),r==t&&r!=a&&(s+=4+(a-e)/n),s/=6),[s,0<o&&o<1?n/(o<.5?2*o:2-2*o):0,o]},r("*",o).mousedown(e.mousedown),e.setColor("#000000"),a&&e.linkTo(a)}}(jQuery);