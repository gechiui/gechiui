!function(r){r.fn.farbtastic=function(t){return r.farbtastic(this,t),this},r.farbtastic=function(t,a){return(t=r(t).get(0)).farbtastic||(t.farbtastic=new r._farbtastic(t,a))},r._farbtastic=function(t,a){var o=this,e=(r(t).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>'),r(".farbtastic",t));o.wheel=r(".wheel",t).get(0),o.radius=84,o.square=100,o.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&r("*",e).each(function(){var t;"none"!=this.currentStyle.backgroundImage&&(t=this.currentStyle.backgroundImage,t=this.currentStyle.backgroundImage.substring(5,t.length-2),r(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+t+"')"}))}),o.linkTo=function(t){return"object"==typeof o.callback&&r(o.callback).off("keyup",o.updateValue),o.color=null,"function"==typeof t?o.callback=t:"object"!=typeof t&&"string"!=typeof t||(o.callback=r(t),o.callback.on("keyup",o.updateValue),o.callback.get(0).value&&o.setColor(o.callback.get(0).value)),this},o.updateValue=function(t){this.value&&this.value!=o.color&&o.setColor(this.value)},o.setColor=function(t){var a=o.unpack(t);return o.color!=t&&a&&(o.color=t,o.rgb=a,o.hsl=o.RGBToHSL(o.rgb),o.updateDisplay()),this},o.setHSL=function(t){return o.hsl=t,o.rgb=o.HSLToRGB(t),o.color=o.pack(o.rgb),o.updateDisplay(),this},o.widgetCoords=function(t){var a=r(o.wheel).offset();return{x:t.pageX-a.left-o.width/2,y:t.pageY-a.top-o.width/2}},o.mousedown=function(t){document.dragging||(r(document).on("mousemove",o.mousemove).on("mouseup",o.mouseup),document.dragging=!0);var a=o.widgetCoords(t);return o.circleDrag=2*Math.max(Math.abs(a.x),Math.abs(a.y))>o.square,o.mousemove(t),!1},o.mousemove=function(t){var a,t=o.widgetCoords(t);return o.circleDrag?((a=Math.atan2(t.x,-t.y)/6.28)<0&&(a+=1),o.setHSL([a,o.hsl[1],o.hsl[2]])):(a=Math.max(0,Math.min(1,.5-t.x/o.square)),t=Math.max(0,Math.min(1,.5-t.y/o.square)),o.setHSL([o.hsl[0],a,t])),!1},o.mouseup=function(){r(document).off("mousemove",o.mousemove),r(document).off("mouseup",o.mouseup),document.dragging=!1},o.updateDisplay=function(){var t=6.28*o.hsl[0];r(".h-marker",e).css({left:Math.round(Math.sin(t)*o.radius+o.width/2)+"px",top:Math.round(-Math.cos(t)*o.radius+o.width/2)+"px"}),r(".sl-marker",e).css({left:Math.round(o.square*(.5-o.hsl[1])+o.width/2)+"px",top:Math.round(o.square*(.5-o.hsl[2])+o.width/2)+"px"}),r(".color",e).css("backgroundColor",o.pack(o.HSLToRGB([o.hsl[0],1,.5]))),"object"==typeof o.callback?(r(o.callback).css({backgroundColor:o.color,color:.5<o.hsl[2]?"#000":"#fff"}),r(o.callback).each(function(){this.value&&this.value!=o.color&&(this.value=o.color)})):"function"==typeof o.callback&&o.callback.call(o,o.color)},o.pack=function(t){var a=Math.round(255*t[0]),o=Math.round(255*t[1]),t=Math.round(255*t[2]);return"#"+(a<16?"0":"")+a.toString(16)+(o<16?"0":"")+o.toString(16)+(t<16?"0":"")+t.toString(16)},o.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},o.HSLToRGB=function(t){var a=t[0],o=t[1],t=t[2],o=t<=.5?t*(o+1):t+o-t*o,t=2*t-o;return[this.hueToRGB(t,o,a+.33333),this.hueToRGB(t,o,a),this.hueToRGB(t,o,a-.33333)]},o.hueToRGB=function(t,a,o){return 6*(o=o<0?o+1:1<o?o-1:o)<1?t+(a-t)*o*6:2*o<1?a:3*o<2?t+(a-t)*(.66666-o)*6:t},o.RGBToHSL=function(t){var a=t[0],o=t[1],t=t[2],e=Math.min(a,Math.min(o,t)),r=Math.max(a,Math.max(o,t)),n=r-e,e=(e+r)/2,s=0;return 0<n&&(r==a&&r!=o&&(s+=(o-t)/n),r==o&&r!=t&&(s+=2+(t-a)/n),r==t&&r!=a&&(s+=4+(a-o)/n),s/=6),[s,0<e&&e<1?n/(e<.5?2*e:2-2*e):0,e]},r("*",e).on("mousedown",o.mousedown),o.setColor("#000000"),a&&o.linkTo(a)}}(jQuery);