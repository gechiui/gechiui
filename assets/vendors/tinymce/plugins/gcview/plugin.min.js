!function(a){a.PluginManager.add("gcview",function(o){function e(){}var n=window.gc;return n&&n.mce&&n.mce.views?(o.on("init",function(){var e=window.MutationObserver||window.WebKitMutationObserver;e&&new e(function(){o.fire("gc-body-class-change")}).observe(o.getBody(),{attributes:!0,attributeFilter:["class"]}),o.on("gc-body-class-change",function(){var n=o.getBody().className;o.$('iframe[class="gcview-sandbox"]').each(function(e,t){if(!t.src||'javascript:""'===t.src)try{t.contentWindow.document.body.className=n}catch(e){}})})}),o.on("beforesetcontent",function(e){var t;if(e.selection||n.mce.views.unbind(),e.content){if(!e.load&&(t=o.selection.getNode())&&t!==o.getBody()&&/^\s*https?:\/\/\S+\s*$/i.test(e.content)){if(!(t=o.dom.getParent(t,"p"))||!/^[\s\uFEFF\u00A0]*$/.test(o.$(t).text()||""))return;t.innerHTML=""}e.content=n.mce.views.setMarkers(e.content,o)}}),o.on("setcontent",function(){n.mce.views.render()}),o.on("preprocess hide",function(e){o.$("div[data-gcview-text], p[data-gcview-marker]",e.node).each(function(e,t){t.innerHTML="."})},!0),o.on("postprocess",function(e){e.content=i(e.content)}),o.on("beforeaddundo",function(e){var t=e.level.content||e.level.fragments&&e.level.fragments.join(""),n=e.lastLevel?e.lastLevel.content||e.lastLevel.fragments&&e.lastLevel.fragments.join(""):o.startContent;t&&n&&-1!==t.indexOf(" data-gcview-")&&-1!==n.indexOf(" data-gcview-")&&i(n)===i(t)&&e.preventDefault()}),o.on("drop objectselected",function(e){c(e.targetClone)&&(e.targetClone=o.getDoc().createTextNode(window.decodeURIComponent(o.dom.getAttrib(e.targetClone,"data-gcview-text"))))}),o.on("pastepreprocess",function(e){var t=e.content;t&&(t=a.trim(t.replace(/<[^>]+>/g,"")),/^https?:\/\/\S+$/i.test(t)&&(e.content=t))}),o.on("resolvename",function(e){c(e.target)&&(e.name=o.dom.getAttrib(e.target,"data-gcview-type")||"object")}),o.on("click keyup",function(){var e=o.selection.getNode();c(e)&&o.dom.getAttrib(e,"data-mce-selected")&&e.setAttribute("data-mce-selected","2")}),o.addButton("gc_view_edit",{tooltip:"Edit|button",icon:"dashicon dashicons-edit",onclick:function(){var e=o.selection.getNode();c(e)&&n.mce.views.edit(o,e)}}),o.addButton("gc_view_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",onclick:function(){o.fire("cut")}}),o.once("preinit",function(){var t;o.gc&&o.gc._createToolbar&&(t=o.gc._createToolbar(["gc_view_edit","gc_view_remove"]),o.on("gctoolbar",function(e){!e.collapsed&&c(e.element)&&(e.toolbar=t)}))}),o.gc=o.gc||{},o.gc.getView=e,{getView:o.gc.setViewCursor=e}):{getView:e};function c(e){return o.dom.hasClass(e,"gcview")}function i(e){function t(e,t){return"<p>"+window.decodeURIComponent(t)+"</p>"}return e&&-1!==e.indexOf(" data-gcview-")?e.replace(/<div[^>]+data-gcview-text="([^"]+)"[^>]*>(?:\.|[\s\S]+?gcview-end[^>]+>\s*<\/span>\s*)?<\/div>/g,t).replace(/<p[^>]+data-gcview-marker="([^"]+)"[^>]*>[\s\S]*?<\/p>/g,t):e}})}(window.tinymce);