!function(P){(!P.ui.FloatPanel.zIndex||P.ui.FloatPanel.zIndex<100100)&&(P.ui.FloatPanel.zIndex=100100),P.PluginManager.add("gechiui",function(m){var a,t,E=P.DOM,g=P.each,p=m.editorManager.i18n.translate,i=window.jQuery,o=window.gc,r=o&&o.editor&&o.editor.autop&&m.getParam("gcautop",!0),c=!1;function e(n){var e,t,o=0,i=P.$(".block-library-classic__toolbar");"hide"===n?e=!0:i.length&&!i.hasClass("has-advanced-toolbar")&&(i.addClass("has-advanced-toolbar"),n="show"),(t=m.theme.panel?m.theme.panel.find(".toolbar:not(.menubar)"):t)&&1<t.length&&(!n&&t[1].visible()&&(n="hide"),g(t,function(e,t){0<t&&("hide"===n?(e.hide(),o+=34):(e.show(),o-=34))})),o&&!P.Env.iOS&&m.iframeElement&&m.iframeElement.clientHeight&&50<(i=m.iframeElement.clientHeight+o)&&E.setStyle(m.iframeElement,"height",i),e||("hide"===n?(setUserSetting("hidetb","0"),a&&a.active(!1)):(setUserSetting("hidetb","1"),a&&a.active(!0))),m.fire("gc-toolbar-toggle")}function d(e){var t,o,i,n=m.translate(e);return c||(o="Shift+Alt+",i="Ctrl+",c={},P.Env.mac&&(o="\u2303\u2325",i="\u2318"),m.settings.gc_shortcut_labels&&g(m.settings.gc_shortcut_labels,function(e,t){var n=m.translate(t);e=e.replace("access",o).replace("meta",i),c[t]=e,t!==n&&(c[n]=e)})),c.hasOwnProperty(n)?t=c[n]:c.hasOwnProperty(e)&&(t=c[e]),t?n+" ("+t+")":n}function n(){}return i&&i(document).triggerHandler("tinymce-editor-setup",[m]),m.addButton("gc_adv",{tooltip:"Toolbar Toggle",cmd:"GC_Adv",onPostRender:function(){(a=this).active("1"===getUserSetting("hidetb"))}}),m.on("PostRender",function(){m.getParam("gechiui_adv_hidden",!0)&&"0"===getUserSetting("hidetb","0")?e("hide"):P.$(".block-library-classic__toolbar").addClass("has-advanced-toolbar")}),m.addCommand("GC_Adv",function(){e()}),m.on("focus",function(){window.gcActiveEditor=m.id}),m.on("BeforeSetContent",function(e){var n;e.content&&(-1!==e.content.indexOf("\x3c!--more")&&(n=p("\u9605\u8bfb\u66f4\u591a\u2026"),e.content=e.content.replace(/<!--more(.*?)-->/g,function(e,t){return'<img src="'+P.Env.transparentSrc+'" data-gc-more="more" data-gc-more-text="'+t+'" class="gc-more-tag mce-gc-more" alt="" title="'+n+'" data-mce-resize="false" data-mce-placeholder="1" />'})),-1!==e.content.indexOf("\x3c!--nextpage--\x3e")&&(n=p("\u5206\u9875\u7b26"),e.content=e.content.replace(/<!--nextpage-->/g,'<img src="'+P.Env.transparentSrc+'" data-gc-more="nextpage" class="gc-more-tag mce-gc-nextpage" alt="" title="'+n+'" data-mce-resize="false" data-mce-placeholder="1" />')),e.load&&"raw"!==e.format&&(e.content=r?o.editor.autop(e.content):e.content.replace(/-->\s+<!--/g,"--\x3e\x3c!--")),-1===e.content.indexOf("<script")&&-1===e.content.indexOf("<style")||(e.content=e.content.replace(/<(script|style)[^>]*>[\s\S]*?<\/\1>/g,function(e,t){return'<img src="'+P.Env.transparentSrc+'" data-gc-preserve="'+encodeURIComponent(e)+'" data-mce-resize="false" data-mce-placeholder="1" class="mce-object" width="20" height="20" alt="&lt;'+t+'&gt;" title="&lt;'+t+'&gt;" />'})))}),m.on("setcontent",function(){m.$("p").each(function(e,t){var n;t.innerHTML&&t.innerHTML.length<10&&((n=P.trim(t.innerHTML))&&"&nbsp;"!==n||(t.innerHTML=P.Env.ie&&P.Env.ie<11?"":'<br data-mce-bogus="1">'))})}),m.on("PostProcess",function(e){e.get&&(e.content=e.content.replace(/<img[^>]+>/g,function(e){var t,n,o="";return-1!==e.indexOf('data-gc-more="more"')?n="\x3c!--more"+(o=(t=e.match(/data-gc-more-text="([^"]+)"/))?t[1]:o)+"--\x3e":-1!==e.indexOf('data-gc-more="nextpage"')?n="\x3c!--nextpage--\x3e":-1!==e.indexOf("data-gc-preserve")&&(t=e.match(/ data-gc-preserve="([^"]+)"/))&&(n=decodeURIComponent(t[1])),n||e}))}),m.on("ResolveName",function(e){var t;"IMG"===e.target.nodeName&&(t=m.dom.getAttrib(e.target,"data-gc-more"))&&(e.name=t)}),m.addCommand("GC_More",function(e){var t,n="gc-more-tag",o=m.dom,i=m.selection.getNode(),a=m.getBody();n+=" mce-gc-"+(e=e||"more"),t=p("more"===e?"Read more...":"Next page"),t='<img src="'+P.Env.transparentSrc+'" alt="" title="'+t+'" class="'+n+'" data-gc-more="'+e+'" data-mce-resize="false" data-mce-placeholder="1" />',i===a||"P"===i.nodeName&&i.parentNode===a?m.insertContent(t):(n=o.getParent(i,function(e){return!(!e.parentNode||e.parentNode!==a)},m.getBody()))&&("P"===n.nodeName?n.appendChild(o.create("p",null,t).firstChild):o.insertAfter(o.create("p",null,t),n),m.nodeChanged())}),m.addCommand("GC_Code",function(){m.formatter.toggle("code")}),m.addCommand("GC_Page",function(){m.execCommand("GC_More","nextpage")}),m.addCommand("GC_Help",function(){var e,t=P.Env.mac?p("Ctrl+Alt+\u5b57\u6bcd\uff1a"):p("Shift+Alt+\u5b57\u6bcd\uff1a"),n=P.Env.mac?p("Cmd+\u5b57\u6bcd\uff1a"):p("Ctrl+\u5b57\u6bcd\uff1a"),o=[],i=[],a={},r={},c=0,d=0,l=m.settings.gc_shortcut_labels;function s(e,t){var n="<tr>",o=0;for(t=t||1,g(e,function(e,t){n+="<td><kbd>"+t+"</kbd></td><td>"+p(e)+"</td>",o++});o<t;)n+="<td></td><td></td>",o++;return n+"</tr>"}l&&(g(l,function(e,t){var n;-1!==e.indexOf("meta")?(c++,(n=e.replace("meta","").toLowerCase())&&(a[n]=t,c%2==0&&(o.push(s(a,2)),a={}))):-1!==e.indexOf("access")&&(d++,(n=e.replace("access","").toLowerCase())&&(r[n]=t,d%2==0&&(i.push(s(r,2)),r={})))}),0<c%2&&o.push(s(a,2)),0<d%2&&i.push(s(r,2)),l="<tr><th>"+(l=[p("\u5b57\u6bcd"),p("\u64cd\u4f5c"),p("\u5b57\u6bcd"),p("\u64cd\u4f5c")]).join("</th><th>")+"</th></tr>",e=(e='<div class="gc-editor-help">')+"<h2>"+p("\u9ed8\u8ba4\u5feb\u6377\u65b9\u5f0f\uff0c")+" "+n+'</h2><table class="gc-help-th-center fixed">'+l+o.join("")+"</table><h2>"+p("\u989d\u5916\u7684\u5feb\u6377\u65b9\u5f0f\uff0c")+" "+t+'</h2><table class="gc-help-th-center fixed">'+l+i.join("")+"</table>",e=(e=m.plugins.gctextpattern&&(!P.Env.ie||8<P.Env.ie)?(e=e+"<h2>"+p("\u5f53\u4f7f\u7528\u8fd9\u4e9b\u683c\u5f0f\u5feb\u6377\u952e\u540e\u8ddf\u7a7a\u683c\u6765\u521b\u5efa\u65b0\u6bb5\u843d\u65f6\uff0c\u8fd9\u4e9b\u683c\u5f0f\u4f1a\u88ab\u81ea\u52a8\u5e94\u7528\u3002\u6309\u9000\u683c\u6216\u9000\u51fa\u952e\u6765\u64a4\u9500\u3002")+'</h2><table class="gc-help-th-center fixed">'+s({"*":"Bullet list","1.":"Numbered list"})+s({"-":"Bullet list","1)":"Numbered list"})+"</table>")+"<h2>"+p("\u4ee5\u4e0b\u683c\u5f0f\u6377\u5f84\u5728\u6309\u56de\u8f66\u952e\u65f6\u88ab\u66ff\u6362\u3002\u8bf7\u6309\u9000\u51fa\u6216\u64a4\u9500\u952e\u6765\u64a4\u9500\u3002")+'</h2><table class="gc-help-single">'+s({">":"Blockquote"})+s({"##":"Heading 2"})+s({"###":"Heading 3"})+s({"####":"Heading 4"})+s({"#####":"Heading 5"})+s({"######":"Heading 6"})+s({"---":"Horizontal line"})+"</table>":e)+"<h2>"+p("\u7126\u70b9\u5feb\u6377\u65b9\u5f0f\uff1a")+'</h2><table class="gc-help-single">'+s({"Alt + F8":"\u5185\u8054\u5de5\u5177\u680f\uff08\u5f53\u56fe\u7247\u3001\u94fe\u63a5\u6216\u9884\u89c8\u88ab\u9009\u4e2d\u65f6\uff09"})+s({"Alt + F9":"\u7f16\u8f91\u83dc\u5355\uff08\u5982\u88ab\u542f\u7528\uff09"})+s({"Alt + F10":"Editor toolbar"})+s({"Alt + F11":"Elements path"})+"</table><p>"+p("\u8981\u79fb\u52a8\u7126\u70b9\u5230\u5176\u4ed6\u6309\u94ae\uff0c\u8bf7\u4f7f\u7528Tab\u6216\u7bad\u5934\u952e\uff1b\u8981\u5c06\u7126\u70b9\u79fb\u56de\u7f16\u8f91\u5668\uff0c\u8bf7\u6309Esc\u6216\u4f7f\u7528\u4efb\u610f\u4e00\u4e2a\u6309\u94ae\u3002")+"</p>",(n=m.windowManager.open({title:m.settings.classic_block_editor?"\u4f20\u7edf\u533a\u5757\u952e\u76d8\u5feb\u6377\u952e":"Keyboard Shortcuts",items:{type:"container",classes:"gc-help",html:e+="</div>"},buttons:{text:"Close",onclick:"close"}})).$el&&(n.$el.find('div[role="application"]').attr("role","document"),(t=n.$el.find(".mce-gc-help"))[0]&&(t.attr("tabindex","0"),t[0].focus(),t.on("keydown",function(e){33<=e.keyCode&&e.keyCode<=40&&e.stopPropagation()}))))}),m.addCommand("GC_Medialib",function(){o&&o.media&&o.media.editor&&o.media.editor.open(m.id)}),m.addButton("gc_more",{tooltip:"\u63d2\u5165\u201cMore\u201d\u6807\u7b7e",onclick:function(){m.execCommand("GC_More","more")}}),m.addButton("gc_page",{tooltip:"Page break",onclick:function(){m.execCommand("GC_More","nextpage")}}),m.addButton("gc_help",{tooltip:"Keyboard Shortcuts",cmd:"GC_Help"}),m.addButton("gc_code",{tooltip:"Code",cmd:"GC_Code",stateSelector:"code"}),o&&o.media&&o.media.editor&&(m.addButton("gc_add_media",{tooltip:"Add Media",icon:"dashicon dashicons-admin-media",cmd:"GC_Medialib"}),m.addMenuItem("add_media",{text:"Add Media",icon:"gc-media-library",context:"insert",cmd:"GC_Medialib"})),m.addMenuItem("gc_more",{text:"\u63d2\u5165\u201cMore\u201d\u6807\u7b7e",icon:"gc_more",context:"insert",onclick:function(){m.execCommand("GC_More","more")}}),m.addMenuItem("gc_page",{text:"Page break",icon:"gc_page",context:"insert",onclick:function(){m.execCommand("GC_More","nextpage")}}),m.on("BeforeExecCommand",function(e){!P.Env.webkit||"InsertUnorderedList"!==e.command&&"InsertOrderedList"!==e.command||(t=t||m.dom.create("style",{type:"text/css"},"#tinymce,#tinymce span,#tinymce li,#tinymce li>span,#tinymce p,#tinymce p>span{font:medium sans-serif;color:#000;line-height:normal;}"),m.getDoc().head.appendChild(t))}),m.on("ExecCommand",function(e){P.Env.webkit&&t&&("InsertUnorderedList"===e.command||"InsertOrderedList"===e.command)&&m.dom.remove(t)}),m.on("init",function(){var e=P.Env,t=["mceContentBody"],n=m.getDoc(),o=m.dom;e.iOS&&o.addClass(n.documentElement,"ios"),"rtl"===m.getParam("directionality")&&(t.push("rtl"),o.setAttrib(n.documentElement,"dir","rtl")),o.setAttrib(n.documentElement,"lang",m.getParam("gc_lang_attr")),e.ie?9===parseInt(e.ie,10)?t.push("ie9"):8===parseInt(e.ie,10)?t.push("ie8"):e.ie<8&&t.push("ie7"):e.webkit&&t.push("webkit"),t.push("gc-editor"),g(t,function(e){e&&o.addClass(n.body,e)}),m.on("BeforeSetContent",function(e){e.content&&(e.content=e.content.replace(/<p>\s*<(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre)( [^>]*)?>/gi,"<$1$2>").replace(/<\/(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre)>\s*<\/p>/gi,"</$1>"))}),i&&i(function(){i(document).triggerHandler("tinymce-editor-init",[m])}),window.tinyMCEPreInit&&window.tinyMCEPreInit.dragDropUpload&&o.bind(n,"dragstart dragend dragover drop",function(e){i&&i(document).trigger(new i.Event(e))}),m.getParam("gc_paste_filters",!0)&&(m.on("PastePreProcess",function(e){e.content=e.content.replace(/<br class="?Apple-interchange-newline"?>/gi,""),P.Env.webkit||(e.content=e.content.replace(/(<[^>]+) style="[^"]*"([^>]*>)/gi,"$1$2"),e.content=e.content.replace(/(<[^>]+) data-mce-style=([^>]+>)/gi,"$1 style=$2"))}),m.on("PastePostProcess",function(e){m.$("p",e.node).each(function(e,t){o.isEmpty(t)&&o.remove(t)}),P.isIE&&m.$("a",e.node).find("font, u").each(function(e,t){o.remove(t,!0)})}))}),m.on("SaveContent",function(e){!m.inline&&m.isHidden()?e.content=e.element.value:(e.content=e.content.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>"),e.content=r?o.editor.removep(e.content):e.content.replace(/-->\s*<!-- gc:/g,"--\x3e\n\n\x3c!-- gc:"))}),m.on("preInit",function(){m.schema.addValidElements("@[id|accesskey|class|dir|lang|style|tabindex|title|contenteditable|draggable|dropzone|hidden|spellcheck|translate],i,b,script[src|async|defer|type|charset|crossorigin|integrity]"),P.Env.iOS&&(m.settings.height=300),g({c:"JustifyCenter",r:"JustifyRight",l:"JustifyLeft",j:"JustifyFull",q:"mceBlockQuote",u:"InsertUnorderedList",o:"InsertOrderedList",m:"GC_Medialib",t:"GC_More",d:"Strikethrough",p:"GC_Page",x:"GC_Code"},function(e,t){m.shortcuts.add("access+"+t,"",e)}),m.addShortcut("meta+s","",function(){o&&o.autosave&&o.autosave.server.triggerSave()}),m.settings.classic_block_editor||m.addShortcut("access+z","","GC_Adv"),m.on("keydown",function(e){var t=P.Env.mac?e.ctrlKey&&e.altKey&&"KeyH"===e.code:e.shiftKey&&e.altKey&&"KeyH"===e.code;return!t||(m.execCommand("GC_Help"),e.stopPropagation(),e.stopImmediatePropagation(),!1)}),1<window.getUserSetting("editor_plain_text_paste_warning")&&(m.settings.paste_plaintext_inform=!1),P.Env.mac&&P.$(m.iframeElement).attr("title",p("\u5bcc\u6587\u672c\u533a\u57df\u3002\u6309Control-Option-H\u83b7\u53d6\u5e2e\u52a9\u3002"))}),m.on("PastePlainTextToggle",function(e){!0===e.state&&(e=parseInt(window.getUserSetting("editor_plain_text_paste_warning"),10)||0)<2&&window.setUserSetting("editor_plain_text_paste_warning",++e)}),m.on("beforerenderui",function(){m.theme.panel&&(g(["button","colorbutton","splitbutton"],function(e){(e=m.theme.panel.find(e))&&g(e,function(e){var t;e&&e.settings.tooltip&&(t=d(e.settings.tooltip),e.settings.tooltip=t,e._aria&&e._aria.label&&(e._aria.label=t))})}),g(m.theme.panel.find("listbox"),function(e){e&&"Paragraph"===e.settings.text&&g(e.settings.values,function(e){e.text&&c.hasOwnProperty(e.text)&&(e.shortcut="("+c[e.text]+")")})}))}),m.on("preinit",function(){var n,v,t,w,_,C,o,r=P.ui.Factory,c=m.settings,e=m.getContainer(),y=document.getElementById("gcadminbar"),x=document.getElementById(m.id+"_ifr");function i(e){if(n)if(n.tempHide||"hide"===e.type||"blur"===e.type)n.hide(),n=!1;else if(("resizewindow"===e.type||"scrollwindow"===e.type||"resize"===e.type||"scroll"===e.type)&&!n.blockHide){if("resize"===e.type||"resizewindow"===e.type){if(e=(e=m.getWin()).innerHeight+e.innerWidth,!(o=o&&2e3<(new Date).getTime()-o.timestamp?null:o))return void(o={timestamp:(new Date).getTime(),size:e});if(e&&Math.abs(e-o.size)<2)return}clearTimeout(t),t=setTimeout(function(){n&&"function"==typeof n.show&&(n.scrolling=!1,n.show())},250),n.scrolling=!0,n.hide()}}e&&(w=P.$(".mce-toolbar-grp",e)[0],_=P.$(".mce-statusbar",e)[0]),"content"===m.id&&(C=document.getElementById("post-status-info")),m.shortcuts.add("alt+119","",function(){var e;n&&(e=n.find("toolbar")[0])&&e.focus(!0)}),m.on("nodechange",function(e){var t=m.selection.isCollapsed(),e={element:e.element,parents:e.parents,collapsed:t};m.fire("gctoolbar",e),v=e.selection||e.element,n&&n!==e.toolbar&&n.hide(),e.toolbar?(n=e.toolbar).visible()?n.reposition():n.show():n=!1}),m.on("focus",function(){n&&n.show()}),m.inline?(m.on("resizewindow",i),document.addEventListener("scroll",i,!0)):(m.dom.bind(m.getWin(),"resize scroll",i),m.on("resizewindow scrollwindow",i)),m.on("remove",function(){document.removeEventListener("scroll",i,!0),m.off("resizewindow scrollwindow",i),m.dom.unbind(m.getWin(),"resize scroll",i)}),m.on("blur hide",i),m.gc=m.gc||{},m.gc._createToolbar=function(e,t){var n,o,a=[];return g(e,function(i){var t,e;function n(){var e=m.selection;"bullist"===t&&e.selectorChanged("ul > li",function(e,t){for(var n,o=t.parents.length;o--&&"OL"!==(n=t.parents[o].nodeName)&&"UL"!=n;);i.active(e&&"UL"===n)}),"numlist"===t&&e.selectorChanged("ol > li",function(e,t){for(var n,o=t.parents.length;o--&&"OL"!==(n=t.parents[o].nodeName)&&"UL"!==n;);i.active(e&&"OL"===n)}),i.settings.stateSelector&&e.selectorChanged(i.settings.stateSelector,function(e){i.active(e)},!0),i.settings.disabledStateSelector&&e.selectorChanged(i.settings.disabledStateSelector,function(e){i.disabled(e)})}"|"===i?o=null:r.has(i)?(i={type:i},c.toolbar_items_size&&(i.size=c.toolbar_items_size),a.push(i),o=null):(o||(o={type:"buttongroup",items:[]},a.push(o)),m.buttons[i]&&(t=i,(i="function"==typeof(i=m.buttons[t])?i():i).type=i.type||"button",c.toolbar_items_size&&(i.size=c.toolbar_items_size),(e=i.tooltip||i.title)&&(i.tooltip=d(e)),i=r.create(i),o.items.push(i),m.initialized?n():m.on("init",n)))}),(n=r.create({type:"panel",layout:"stack",classes:"toolbar-grp inline-toolbar-grp",ariaRoot:!0,ariaRemember:!0,items:[{type:"toolbar",layout:"flow",items:a}]})).bottom=t,n.on("show",function(){this.reposition()}),n.on("keydown",function(e){27===e.keyCode&&(this.hide(),m.focus())}),m.on("remove",function(){n.remove()}),n.reposition=function(){if(!v)return this;var e,t=window.pageXOffset||document.documentElement.scrollLeft,n=window.pageYOffset||document.documentElement.scrollTop,o=window.innerWidth,i=window.innerHeight,a=x?x.getBoundingClientRect():{top:0,right:o,bottom:i,left:0,width:o,height:i},r=this.getEl(),c=r.offsetWidth,d=r.clientHeight,l=v.getBoundingClientRect(),s=(l.left+l.right)/2,m=d+5,g=y?y.getBoundingClientRect().bottom:0,p=w?w.getBoundingClientRect().bottom:0,u=_?i-_.getBoundingClientRect().top:0,h=C?i-C.getBoundingClientRect().top:0,g=Math.max(0,g,p,a.top),p=Math.max(0,u,h,i-a.bottom),u=l.top+a.top-g,h=i-a.top-l.bottom-p,i=i-g-p,p="",f=0,b=0;return i<=u||i<=h?(this.scrolling=!0,this.hide(),this.scrolling=!1):(P.Env.iOS&&"IMG"===v.nodeName&&(f=54,b=46),this.bottom?m<=h?(p=" mce-arrow-up",e=l.bottom+a.top+n-b):m<=u&&(p=" mce-arrow-down",e=l.top+a.top+n-d+f):m<=u?(p=" mce-arrow-down",e=l.top+a.top+n-d+f):m<=h&&i/2>l.bottom+a.top-g&&(p=" mce-arrow-up",e=l.bottom+a.top+n-b),void 0===e&&(e=n+g+5+b),u=s-c/2+a.left+t,l.left<0||l.right>a.width?u=a.left+t+(a.width-c)/2:o<=c?(p+=" mce-arrow-full",u=0):u<0&&l.left+c>o||o<u+c&&l.right-c<0?u=(o-c)/2:u<a.left+t?(p+=" mce-arrow-left",u=l.left+a.left+t):u+c>a.width+a.left+t&&(p+=" mce-arrow-right",u=l.right-c+a.left+t),P.Env.iOS&&"IMG"===v.nodeName&&(p=p.replace(/ ?mce-arrow-(up|down)/g,"")),r.className=r.className.replace(/ ?mce-arrow-[\w]+/g,"")+p,E.setStyles(r,{left:u,top:e})),this},n.hide().renderTo(document.body),n}},!0),{_showButtons:n,_hideButtons:n,_setEmbed:n,_getEmbed:n}})}(window.tinymce);